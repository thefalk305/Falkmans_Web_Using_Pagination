<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>Falkman Family History</title>
  <meta content="Falkman family history site." name="description" />
  <meta content="family history, ancestors, family, parents, grand parents, aunts & uncles, sibling, brothers & sisters, great-grandparents, cousins" name="keywords" />
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
  <meta content="en-us" http-equiv="Content-Language" />
  <meta content="Allen Falkman" name="author" />
  <meta content="General" name="rating" />
  <meta content="no" http-equiv="imagetoolbar" />
  <meta content="Copyright ï¿½ 2010, Allen Falkman All Rights Reserved" name="copyright" />

  <meta name="page-title" content="Photo Collage for Allen Falkman Sr" />

	<link href="../css/magnify.css" rel="stylesheet" type="text/css" />
	<link href="../css/records.css" rel="stylesheet" type="text/css" />
	<link href="../css/collage.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="../assets/favicon.ico">

</head>

<body>

<div id="container" style="text-align: center;" >
	
  <!-- Inserts the common header-->
   <!-- header contains 'banner', navigation and magnification controls -->
  <div id="header"></div>
  <script src="../js/loadHeader.js"></script>
  
  <h2>Click on an image to zoom it.</h2>
  <div class="doc-container">
    <div class="img-magnifier-container">
      <img id="doc-image" class="magImage" src="../records/Allen Falkman Sr Collage.svg" alt="Document" style="width: 100%;" />

      <div id="area1" class="highlight-box area" style="left: 2%; top: 3%; width: 31%; height: 53%;" data-caption="At age 15, Allen was a messenger for the 1933 Worlds Fair in Chicago."></div>
      <div id="area2" class="highlight-box area" style="left: 36%; top: 2%; width: 57%; height: 55%;" data-caption="Somehow Al persuaded his mother (Mary) to chauffer him around while he was in the Army."></div>
      <div id="area3" class="highlight-box area" style="left: 1%; top: 60%; width: 29%; height: 39%;" data-caption="Doesn't Al look sharp in uniform. What a good looking soldier."></div>
      <div id="area4" class="highlight-box area" style="left: 32%; top: 61%; width: 26%; height: 38%;" data-caption="Here's a pic of young Al with an even younger admirer."></div>
      <div id="area5" class="highlight-box area" style="left: 61%; top: 60%; width: 32%; height: 39%;" data-caption="Al has to look sharp for the ladies of Europe."></div>
    </div>
  </div>  
  <!-- Inserts the common footer. -->
  <div id="footer"></div>
  <script src="../js/loadFooter.js"></script>
</div>

<!-- script for magnifier glass -->
<script type="module">
  import { initMagnifierControls } from '../js/magnifier.js';
  document.addEventListener('DOMContentLoaded', () => {
    // Wait briefly to ensure header/footer are loaded
    setTimeout(() => {
      initMagnifierControls();
    }, 100); // You can adjust this delay if needed
  });
</script>

<!-- script for Photo Collage -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const img = document.getElementById('doc-image');
  const imgSrc = img.src;
  const ENLARGED_WIDTH_PERCENT = 60;

  // Cache original dimensions for each highlight box
  document.querySelectorAll('.highlight-box.area').forEach(box => {
    box.dataset.originalWidth = box.style.width;
    box.dataset.originalHeight = box.style.height;
    box.dataset.originalLeft = box.style.left;
    box.dataset.originalTop = box.style.top;
    box.dataset.originalTransform = box.style.transform || '';
  });

  document.querySelectorAll('.highlight-box.area').forEach(box => {
    box.addEventListener('click', (e) => {
      e.stopPropagation();

      const isAlreadyEnlarged = box.classList.contains('enlarged');

      // Always remove all captions from all boxes
      document.querySelectorAll('.zoom-caption').forEach(caption => caption.remove());

      // Reset all boxes to original size and position
      document.querySelectorAll('.highlight-box.enlarged').forEach(el => {
        el.classList.remove('enlarged');
        el.style.width = el.dataset.originalWidth;
        el.style.height = el.dataset.originalHeight;
        el.style.left = el.dataset.originalLeft;
        el.style.top = el.dataset.originalTop;
        el.style.transform = el.dataset.originalTransform;
        el.style.backgroundImage = '';
        el.style.backgroundSize = '';
        el.style.backgroundPosition = '';
      });

      if (!isAlreadyEnlarged) {
        // Get original box dimensions and position (percentages)
        const originalWidthPercent = parseFloat(box.dataset.originalWidth);
        const originalHeightPercent = parseFloat(box.dataset.originalHeight);
        const originalLeftPercent = parseFloat(box.dataset.originalLeft);
        const originalTopPercent = parseFloat(box.dataset.originalTop);

        // Calculate aspect ratio
        const aspectRatio = originalHeightPercent / originalWidthPercent;

        // Set enlarged size
        const enlargedWidthPercent = ENLARGED_WIDTH_PERCENT;
        const enlargedHeightPercent = enlargedWidthPercent * aspectRatio;

        box.style.width = `${enlargedWidthPercent}%`;
        box.style.height = `${enlargedHeightPercent}%`;
        box.style.left = '50%';
        box.style.top = '50%';
        box.style.transform = 'translate(-50%, -50%)';

        // Get the image's current pixel dimensions
        const imgWidth = img.width;
        const imgHeight = img.height;

        // Calculate the original box's position and size in pixels
        const boxLeftPx = imgWidth * (originalLeftPercent / 100);
        const boxTopPx = imgHeight * (originalTopPercent / 100);
        const boxWidthPx = imgWidth * (originalWidthPercent / 100);
        const boxHeightPx = imgHeight * (originalHeightPercent / 100);

        // Calculate the enlarged box's size in pixels
        const enlargedBoxWidthPx = imgWidth * (enlargedWidthPercent / 100);
        const enlargedBoxHeightPx = imgHeight * (enlargedHeightPercent / 100);

        // The zoom factor is how much larger the enlarged box is compared to the original box
        const zoomFactor = enlargedBoxWidthPx / boxWidthPx;

        // Set the background image and size (zoomed)
        box.style.backgroundImage = `url('${imgSrc}')`;
        box.style.backgroundSize = `${imgWidth * zoomFactor}px ${imgHeight * zoomFactor}px`;

        // Calculate the background position so the original area is centered in the enlarged box
        // Center of the original box in image coordinates
        const centerX = boxLeftPx + boxWidthPx / 2;
        const centerY = boxTopPx + boxHeightPx / 2;

        // In the zoomed image, the center moves by the zoom factor
        const bgCenterX = centerX * zoomFactor;
        const bgCenterY = centerY * zoomFactor;

        // The background position should move the center of the zoomed area to the center of the box
        const bgPosX = enlargedBoxWidthPx / 2 - bgCenterX;
        const bgPosY = enlargedBoxHeightPx / 2 - bgCenterY;
        box.style.backgroundPosition = `${bgPosX}px ${bgPosY}px`;

        // Add caption below the enlarged box
        const caption = document.createElement('div');
        caption.className = 'zoom-caption';
        caption.textContent = box.dataset.caption || 'zoomed image';
        box.appendChild(caption);

        box.classList.add('enlarged');
      }
    });
  });
});
</script>

</body>
</html>